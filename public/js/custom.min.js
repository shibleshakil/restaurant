$(document).ready(function ($) {
    // Go to URL
    $('select.gotourl').on('change', function () {
        var url = $(this).val();
        if (url) { window.location = url; }
        return false;
    });
    $("#menu").on("change", function () {
        var id = $(this).val();
        var name = $("#menu option:selected").text();
        if (id != "") {
            var sl = parseInt($("#ingredient_sl").val());
            var sum = sl + 1;
            var count = $("#ingredient_count").val() + 1;
            $("#ingredient_count").val(count);
            $("#ingredient_sl").val(sum);
            var newRow = '<tr id="ingredient_row_' + count + '">' +
                '<td id="sl_' + count + '">' + sum + '</td>' +
                '<td>' +
                '<input type="hidden" id="ordered_menu_' + count + '" name="ordered_menu[]" value="' + id + '">' +
                '<span id="ingreadient_name_' + count + '">' + name + '</span>' +
                '</td>' +
                '<td>' +
                '<div class="input-group">' +
                '<input type="number" class="form-control w-100" id="quantity_' + count + '" name="quantity[]" value="1">' +
                '</div>' +
                '</td>' +
                '<td>' +
                '<button type="button" title="Delete" class="btn btn-danger" onclick="deleteOrderedMenu(this)" data-count="' + count + '"> <i class="fa fa-trash"></i></button>' +
                '</td>' +
                '</tr>';
            $('#ingredient_items').append(newRow);
        }
    });
});

function deleteOrderedMenu(cr) {
    var rowId = $(cr).attr('data-count');
    var el = document.getElementById("ingredient_row_" + rowId);
    el.remove();

    var sl = parseInt($("#ingredient_sl").val());
    var sum = sl - 1;

    $("#ingredient_sl").val(sum);
}

function reserveSelectedTime(url) {
    var restaurant = $("#book_restaurant").val();
    var restaurantName = $("#book_restaurant option:selected").text();
    var booking_date = $("#booking_date").val();
    var no_of_guest = $("#no_of_guest").val();
    var preferred_time = $("#preferred_time").val();

    $.ajax({
        url: url,
        type: "POST",
        data: {
            "_token": $("#csrfToken").val(),
            'restaurant': restaurant,
            'restaurantName': restaurantName,
            'booking_date': booking_date,
            'no_of_guest': no_of_guest,
            'preferred_time': preferred_time,
        },
        dataType: "json",

        success: function (data) {
            if (data.length > 0) {
                $.each(data, function (index, value) {
                    $("#bookedRestaurant").html(value['restaurantName']);
                    $("#bookedDate").html(value['booking_date']);
                    $("#bookedGuest").html(value['no_of_guest'] + ' guests ');
                    $("#bookedTime").html(value['preferred_time']);
                    $("#booking_step_1").hide();
                    $("#booking_step_2").show();
                });
            } else {
                console.log('Error');
            }
        },

        error: function (e) {
            console.log(e);
        }
    });
}

function checkResttaurantInfo(url, id, view1, view2) {
    $.ajax({
        url: url,
        type: "get",
        data: {
            "id": id,
        },
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
        success: function (data) {
            $(view1).removeAttr("disabled");
            $(view2).removeAttr("disabled");
            $("#booking_date").removeAttr("readonly");

            if (data['guest'].length > 0) {
                var output1 = '<option value="">Select No of Guest</option>';
                $.each(data['guest'], function (index, value) {
                    output1 += '<option value="' + value + '">' + value + '</option>';
                });
                output1 += '<option value="group">Large Group</option>';
            } else {
                var output1 = '<option value="">Fully Booked</option>';
            }
            $(view1).html(output1);

            if (data['times'].length > 0) {
                var output = '<option value="">Select Prefered Time</option>';
                $.each(data['times'], function (index, value) {
                    output += '<option value="' + value + '">' + value + '</option>';
                });
            } else {
                var output = '<option value="">No Prefered Time Found</option>';
            }
            $(view2).html(output);
        },

        error: function (e) {
            console.log(e);
        }
    });
}

function restaurantMenuList(id, url, view) {
    $.ajax({
        url: url,
        type: "get",
        data: {
            "id": id,
        },
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
        success: function (data) {
            if (data.length > 0) {
                var output = '<option value="">Select Menu</option>';
                $.each(data, function (index, value) {
                    output += '<option value="' + value['id'] + '">' + value['name'] + '  Price : ' + value['price'] + '</option>';
                });
            } else {
                var output = '<option value="">No Menu Found</option>';
            }
            $(view).html(output);
        },

        error: function (e) {
            console.log(e);
        }
    });
}